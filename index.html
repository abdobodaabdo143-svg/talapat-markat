<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…ØªØ§Ø¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</title>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js"></script>
  
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --primary-dark: #5a67d8;
      --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
      --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      --light-bg: #f8fafc;
      --dark-text: #1e293b;
      --card-bg: rgba(255, 255, 255, 0.95);
      --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      --shadow-hover: 0 15px 35px rgba(0, 0, 0, 0.15);
      --border-radius-lg: 20px;
      --border-radius-md: 12px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', 'Cairo', sans-serif;
      background: var(--light-bg);
      color: var(--dark-text);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    .login-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .login-card {
      background: white;
      border-radius: var(--border-radius-lg);
      padding: 50px 40px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 100%;
      animation: slideUp 0.6s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .login-icon {
      font-size: 4rem;
      color: #667eea;
      margin-bottom: 20px;
    }
    
    .login-title {
      font-size: 2.2rem;
      margin-bottom: 15px;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .login-subtitle {
      color: #666;
      margin-bottom: 40px;
      font-size: 1.1rem;
      line-height: 1.6;
    }
    
    .google-btn {
      background: white;
      border: 2px solid #ddd;
      border-radius: var(--border-radius-md);
      padding: 15px 30px;
      font-size: 1.1rem;
      font-weight: 600;
      color: #444;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin: 0 auto;
      transition: all 0.3s;
      width: 100%;
      max-width: 300px;
    }
    
    .google-btn:hover {
      background: #f8f9fa;
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .google-icon {
      width: 24px;
      height: 24px;
    }
    
    /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
    .app-screen {
      display: none;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin-bottom: 30px;
      border-bottom: 2px solid #eaeaea;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #667eea;
    }
    
    .user-details h3 {
      font-size: 1.2rem;
      margin-bottom: 5px;
    }
    
    .user-details p {
      color: #666;
      font-size: 0.9rem;
    }
    
    .logout-btn {
      background: #ef4444;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: var(--border-radius-md);
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }
    
    .logout-btn:hover {
      background: #dc2626;
      transform: translateY(-2px);
    }
    
    /* ØªØµÙ…ÙŠÙ… Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      border-radius: var(--border-radius-md);
      padding: 25px;
      text-align: center;
      box-shadow: var(--shadow);
      transition: all 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 10px;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .stat-label {
      font-size: 1rem;
      color: #666;
      font-weight: 600;
    }
    
    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }
    
    @media (max-width: 992px) {
      .main-content {
        grid-template-columns: 1fr;
      }
    }
    
    .card {
      background: white;
      border-radius: var(--border-radius-lg);
      padding: 30px;
      box-shadow: var(--shadow);
      transition: all 0.3s;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f1f5f9;
    }
    
    .card-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
      background: var(--primary-gradient);
    }
    
    .card-title {
      font-size: 1.5rem;
      color: #333;
      font-weight: 700;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
    }
    
    .form-input {
      width: 100%;
      padding: 15px;
      border-radius: var(--border-radius-md);
      border: 2px solid #ddd;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .btn-group {
      display: flex;
      gap: 15px;
      margin-top: 25px;
    }
    
    .btn {
      flex: 1;
      padding: 15px;
      border-radius: var(--border-radius-md);
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn-primary {
      background: var(--primary-gradient);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: #f1f5f9;
      color: #555;
      border: 2px solid #ddd;
    }
    
    .btn-secondary:hover {
      background: #e2e8f0;
    }
    
    .result-card {
      display: none;
      flex-direction: column;
      align-items: center;
      padding: 30px;
      text-align: center;
    }
    
    .progress-container {
      width: 150px;
      height: 150px;
      margin-bottom: 20px;
      position: relative;
    }
    
    .progress-circle {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(#667eea 0deg, #eee 0deg);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    
    .progress-circle::before {
      content: '';
      position: absolute;
      width: 120px;
      height: 120px;
      background: white;
      border-radius: 50%;
    }
    
    .progress-value {
      position: relative;
      z-index: 1;
      font-size: 2rem;
      font-weight: 700;
      color: #667eea;
    }
    
    .result-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      width: 100%;
      margin-top: 20px;
    }
    
    .result-item {
      background: #f8fafc;
      padding: 15px;
      border-radius: var(--border-radius-md);
      text-align: center;
    }
    
    .result-label {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 5px;
    }
    
    .result-number {
      font-size: 1.4rem;
      font-weight: 700;
      color: #333;
    }
    
    .history-section {
      margin-top: 40px;
    }
    
    .history-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: var(--border-radius-md);
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    
    th {
      background: #f8fafc;
      padding: 15px;
      text-align: center;
      font-weight: 600;
      color: #555;
      border-bottom: 2px solid #eee;
    }
    
    td {
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }
    
    tr:hover {
      background: #f8fafc;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #888;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: var(--border-radius-md);
      color: white;
      font-weight: 600;
      z-index: 1000;
      box-shadow: var(--shadow);
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .notification.success {
      background: var(--success-gradient);
    }
    
    .notification.error {
      background: var(--danger-gradient);
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginScreen" class="login-screen">
    <div class="login-card">
      <div class="login-icon">
        <i class="fas fa-chart-line"></i>
      </div>
      <h1 class="login-title">Ù…ØªØ§Ø¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h1>
      <p class="login-subtitle">
        Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø³Ø§Ø¨ Ø¬ÙˆØ¬Ù„ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø£ÙˆØ±Ø¯Ø±Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
      </p>
      <button id="googleSignInBtn" class="google-btn">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" 
             class="google-icon" 
             alt="Google logo">
        <span>Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬ÙˆØ¬Ù„</span>
      </button>
      <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
        <p>Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...</p>
      </div>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <div id="appScreen" class="app-screen">
    <div class="container">
      <div class="header">
        <div>
          <h1><i class="fas fa-chart-line"></i> Ù…ØªØ§Ø¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h1>
          <p>ØªØ§Ø¨Ø¹ Ø£Ø¯Ø§Ø¦Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ ÙˆØ­Ù‚Ù‚ Ø£Ù‡Ø¯Ø§ÙÙƒ</p>
        </div>
        <div class="user-info">
          <div>
            <h3 id="userName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
            <p id="userEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
          </div>
          <img id="userAvatar" class="user-avatar" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
          <button class="logout-btn" onclick="signOut()">
            <i class="fas fa-sign-out-alt"></i>
            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
          </button>
        </div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalDays">0</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙŠØ§Ù…</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalOrders">0</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalProfit">0 Ø¬.Ù…</div>
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgCompletion">0%</div>
          <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</div>
        </div>
      </div>
      
      <div class="main-content">
        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-calculator"></i>
            </div>
            <div class="card-title">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
          </div>
          
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-bullseye"></i> Ø§Ù„ØªØ§Ø±Ø¬Øª Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª)
            </label>
            <input type="number" id="target" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©" min="1">
          </div>
          
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-check-circle"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø§Ù„Ù…Ù†ÙØ°Ø©
            </label>
            <input type="number" id="done" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø§Ù„Ù…Ù†ÙØ°Ø©" min="0">
          </div>
          
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-money-bill-wave"></i> Ø§Ù„Ù…ÙƒØ³Ø¨ Ù…Ù† Ø§Ù„Ø£ÙˆØ±Ø¯Ø± Ø§Ù„ÙˆØ§Ø­Ø¯ (Ø¬Ù†ÙŠØ©)
            </label>
            <input type="number" id="profitPerOrder" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙƒØ³Ø¨ Ù…Ù† ÙƒÙ„ Ø£ÙˆØ±Ø¯Ø±" min="1">
          </div>
          
          <div class="btn-group">
            <button class="btn btn-primary" onclick="calculate()">
              <i class="fas fa-calculator"></i>
              Ø§Ø­Ø³Ø¨ ÙˆØ§Ø­ÙØ¸
            </button>
            <button class="btn btn-secondary" onclick="clearInputs()">
              <i class="fas fa-eraser"></i>
              Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            </button>
          </div>
        </div>
        
        <div class="card result-card" id="resultCard">
          <div class="progress-container">
            <div class="progress-circle" id="progressCircle">
              <div class="progress-value" id="progressValue">0%</div>
            </div>
          </div>
          
          <h3 id="resultTitle">Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙŠÙˆÙ…</h3>
          
          <div class="result-grid">
            <div class="result-item">
              <div class="result-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
              <div class="result-number" id="resultDate"></div>
            </div>
            <div class="result-item">
              <div class="result-label">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</div>
              <div class="result-number" id="resultDone"></div>
            </div>
            <div class="result-item">
              <div class="result-label">Ø§Ù„Ù†Ø³Ø¨Ø©</div>
              <div class="result-number" id="resultPercent"></div>
            </div>
            <div class="result-item">
              <div class="result-label">Ø§Ù„Ù…ÙƒØ³Ø¨</div>
              <div class="result-number" id="resultProfit"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="history-section">
        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <i class="fas fa-history"></i>
            </div>
            <div class="card-title">Ø³Ø¬Ù„ Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
          </div>
          
          <div id="historyContent">
            <table class="history-table">
              <thead>
                <tr>
                  <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                  <th>Ø§Ù„Ù‡Ø¯Ù</th>
                  <th>Ø§Ù„Ù…Ù†ÙØ°</th>
                  <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                  <th>Ø§Ù„Ù…ÙƒØ³Ø¨</th>
                  <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                </tr>
              </thead>
              <tbody id="history">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
              </tbody>
            </table>
            
            <div id="emptyHistory" class="empty-state">
              <i class="fas fa-clipboard-list fa-3x"></i>
              <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</h3>
              <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ Ù„ØªØ±Ù‰ Ø³Ø¬Ù„Ùƒ Ù‡Ù†Ø§</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===========================================
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
    // ===========================================
    const firebaseConfig = {
      apiKey: "AIzaSyC8QHvPhVTgSzEWEyn5oNeaMN8DQQh7DNs",
      authDomain: "talpat-13d32.firebaseapp.com",
      projectId: "talpat-13d32",
      storageBucket: "talpat-13d32.firebasestorage.app",
      messagingSenderId: "304719296742",
      appId: "1:304719296742:web:023b33918b9c3c2b2b2327",
      measurementId: "G-NRWN5L5HVD"
    };

    // ØªÙ‡ÙŠØ¦Ø© Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const analytics = firebase.analytics();

    // Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    let currentUser = null;
    let userData = null;

    // ===========================================
    // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    // ===========================================
    async function signInWithGoogle() {
      try {
        showLoading(true);
        
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('profile');
        provider.addScope('email');
        
        const result = await auth.signInWithPopup(provider);
        currentUser = result.user;
        
        await loadUserData();
        showAppScreen();
        showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        
        // ØªØ­Ù„ÙŠÙ„Ø§Øª
        analytics.logEvent('login_success');
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }

    async function signOut() {
      try {
        await auth.signOut();
        currentUser = null;
        userData = null;
        showLoginScreen();
        showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
      }
    }

    // ===========================================
    // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    // ===========================================
    async function loadUserData() {
      if (!currentUser) return;
      
      try {
        showLoading(true);
        
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        
        if (userDoc.exists) {
          userData = userDoc.data();
        } else {
          // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
          userData = {
            history: [],
            settings: {
              lastTarget: 0,
              lastProfitPerOrder: 0
            },
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          };
          
          await db.collection('users').doc(currentUser.uid).set(userData);
        }
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        updateUIFromData();
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
      } finally {
        showLoading(false);
      }
    }

    async function saveUserData() {
      if (!currentUser || !userData) return;
      
      try {
        userData.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
        await db.collection('users').doc(currentUser.uid).set(userData, { merge: true });
        return true;
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        return false;
      }
    }

    async function addDailyRecord(data) {
      if (!currentUser || !userData) return;
      
      const dateKey = new Date().toLocaleDateString('en-CA');
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù†ÙØ³ Ø§Ù„ØªØ§Ø±ÙŠØ®
      const existingIndex = userData.history.findIndex(item => item.dateKey === dateKey);
      
      if (existingIndex !== -1) {
        userData.history[existingIndex] = data;
      } else {
        userData.history.push(data);
      }
      
      // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      userData.settings.lastTarget = data.target;
      userData.settings.lastProfitPerOrder = data.profitPerOrder;
      
      const saved = await saveUserData();
      if (saved) {
        updateUIFromData();
        showResult(data);
        showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        analytics.logEvent('add_record');
      }
    }

    // ===========================================
    // ÙˆØ¸Ø§Ø¦Ù ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    // ===========================================
    function showLoginScreen() {
      document.getElementById('loginScreen').style.display = 'flex';
      document.getElementById('appScreen').style.display = 'none';
    }

    function showAppScreen() {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('appScreen').style.display = 'block';
      updateUserInfo();
    }

    function updateUserInfo() {
      if (!currentUser) return;
      
      document.getElementById('userName').textContent = currentUser.displayName || 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
      document.getElementById('userEmail').textContent = currentUser.email;
      document.getElementById('userAvatar').src = currentUser.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(currentUser.displayName || 'User') + '&background=667eea&color=fff';
    }

    function updateUIFromData() {
      if (!userData) return;
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      const settings = userData.settings || {};
      document.getElementById('target').value = settings.lastTarget || '';
      document.getElementById('profitPerOrder').value = settings.lastProfitPerOrder || '';
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„
      renderHistory();
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      updateSummary();
    }

    function calculate() {
      const target = Number(document.getElementById('target').value);
      const done = Number(document.getElementById('done').value);
      const profitPerOrder = Number(document.getElementById('profitPerOrder').value);
      
      if (!target || !done || !profitPerOrder) {
        showNotification('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        return;
      }
      
      const percent = Math.min(((done / target) * 100), 100).toFixed(2);
      const profit = done * profitPerOrder;
      const date = new Date().toLocaleDateString('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      
      const dateKey = new Date().toLocaleDateString('en-CA');
      const timestamp = new Date().getTime();
      
      const data = {
        date,
        dateKey,
        target,
        done,
        percent: parseFloat(percent),
        profit,
        profitPerOrder,
        timestamp
      };
      
      if (currentUser) {
        addDailyRecord(data);
      } else {
        showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
      }
    }

    function renderHistory() {
      const history = userData?.history || [];
      const tbody = document.getElementById('history');
      const emptyState = document.getElementById('emptyHistory');
      
      if (history.length === 0) {
        tbody.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }
      
      // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø³Ø¬Ù„ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
      history.sort((a, b) => b.timestamp - a.timestamp);
      
      emptyState.style.display = 'none';
      
      let tbodyHTML = '';
      
      history.forEach((item) => {
        const status = item.percent >= 100 ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°';
        const statusClass = item.percent >= 100 ? 'status-completed' : 'status-pending';
        
        tbodyHTML += `
          <tr>
            <td>${item.date}</td>
            <td>${item.target}</td>
            <td>${item.done}</td>
            <td>${item.percent}%</td>
            <td>${item.profit.toLocaleString()} Ø¬.Ù…</td>
            <td><span class="${statusClass}">${status}</span></td>
          </tr>
        `;
      });
      
      tbody.innerHTML = tbodyHTML;
    }

    function updateSummary() {
      const history = userData?.history || [];
      
      if (history.length === 0) {
        document.getElementById('totalDays').textContent = '0';
        document.getElementById('totalOrders').textContent = '0';
        document.getElementById('totalProfit').textContent = '0 Ø¬.Ù…';
        document.getElementById('avgCompletion').textContent = '0%';
        return;
      }
      
      const totalDays = history.length;
      const totalOrders = history.reduce((sum, item) => sum + item.done, 0);
      const totalProfit = history.reduce((sum, item) => sum + item.profit, 0);
      const avgCompletion = history.reduce((sum, item) => sum + parseFloat(item.percent), 0) / totalDays;
      
      document.getElementById('totalDays').textContent = totalDays;
      document.getElementById('totalOrders').textContent = totalOrders;
      document.getElementById('totalProfit').textContent = `${totalProfit.toLocaleString()} Ø¬.Ù…`;
      document.getElementById('avgCompletion').textContent = `${avgCompletion.toFixed(1)}%`;
    }

    function showResult(data) {
      const resultCard = document.getElementById('resultCard');
      const progressCircle = document.getElementById('progressCircle');
      const progressValue = document.getElementById('progressValue');
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©
      resultCard.style.display = 'flex';
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ…
      document.getElementById('resultDate').textContent = data.date;
      document.getElementById('resultDone').textContent = `${data.done} / ${data.target}`;
      document.getElementById('resultPercent').textContent = `${data.percent}%`;
      document.getElementById('resultProfit').textContent = `${data.profit.toLocaleString()} Ø¬.Ù…`;
      
      // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„ØªÙ‚Ø¯Ù…
      const percent = data.percent;
      progressCircle.style.background = `conic-gradient(#667eea ${percent}%, #eee ${percent}% 100%)`;
      progressValue.textContent = `${percent}%`;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„Ø£Ø¯Ø§Ø¡
      const resultTitle = document.getElementById('resultTitle');
      if (percent >= 100) {
        resultTitle.textContent = 'ğŸ‰ Ø¥Ù†Ø¬Ø§Ø² Ø±Ø§Ø¦Ø¹! ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù‡Ø¯Ù';
        resultTitle.style.color = '#059669';
      } else if (percent >= 80) {
        resultTitle.textContent = 'âœ¨ Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²! Ø§Ù‚ØªØ±Ø¨Øª Ù…Ù† Ø§Ù„Ù‡Ø¯Ù';
        resultTitle.style.color = '#667eea';
      } else if (percent >= 50) {
        resultTitle.textContent = 'ğŸ‘ Ø¬ÙŠØ¯ØŒ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªÙ‚Ø¯Ù…';
        resultTitle.style.color = '#f59e0b';
      } else {
        resultTitle.textContent = 'ğŸ’ª ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¨Ø°Ù„ Ø¬Ù‡Ø¯ Ø£ÙƒØ«Ø±';
        resultTitle.style.color = '#ef4444';
      }
    }

    function clearInputs() {
      document.getElementById('done').value = '';
      document.getElementById('resultCard').style.display = 'none';
    }

    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    function showLoading(show) {
      document.getElementById('loading').style.display = show ? 'block' : 'none';
    }

    // ===========================================
    // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    // ===========================================
    document.getElementById('googleSignInBtn').addEventListener('click', signInWithGoogle);

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        await loadUserData();
        showAppScreen();
      } else {
        showLoginScreen();
      }
    });
  </script>
</body>
</html>